local requestfunction = syn and syn.request or http and http.request or http_request or fluxus and fluxus.request or getgenv().request or request
local LocalPlayer = game.Players.LocalPlayer
local _NetManaged = game.ReplicatedStorage:WaitForChild("rbxts_include")["node_modules"]["net"]["out"]["_NetManaged"]
local RenderStepTable = {}
local function bindRenderStep(name, number, givenfunction)
	if RenderStepTable[name] == nil then
		RenderStepTable[name] = game:GetService("RunService").RenderStepped:Connect(givenfunction)
	end
end
local function unbindRenderStep(name)
	if RenderStepTable[name] then
		RenderStepTable[name]:Disconnect()
		RenderStepTable[name] = nil
	end
end
local function buywool(woolamount)
	for woolnumber = 1, woolamount, 1 do
		if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") and LocalPlayer.Character:FindFirstChild("Humanoid").Health > 0 then
			_NetManaged.BedwarsPurchaseItem:InvokeServer(
				{shopItem = {price = 0, currency = 0, itemType = "wool_white", amount = 0}}
			)
		end
	end
end
local function checkwool()
	for descendantnumber, descendant in pairs(game.ReplicatedStorage.Inventories:GetDescendants()) do
		if descendant.Parent.Name == LocalPlayer.Name then
		    if descendant.Name == "wool_" .. string.lower(tostring(LocalPlayer.Team.Name)) then
			    return true
			else
			    return false
		    end
		end
	end
end
local function convertposition(vector3)
    return Vector3.new(math.ceil(vector3.X / 3), math.ceil(vector3.Y / 3), math.ceil(vector3.Z / 3))
end
local function convertscaffoldposition(vector3)
    return Vector3.new(math.floor((vector3.X / 3) + 0.5), math.floor((vector3.Y / 3) + 0.5), math.floor((vector3.Z / 3) + 0.5))
end
local function PlaceBlock(position, blockType)
    _NetManaged.PlaceBlock:InvokeServer(
        {
            ["position"] = position,
            ["blockType"] = blockType
        }
    )
end
local function trapplayer()
    for childnumber, child in pairs(game.Players:GetChildren()) do
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and child ~= LocalPlayer and child.TeamColor ~= game.Teams.Spectators.TeamColor and child.Character and child.Character:FindFirstChild("HumanoidRootPart")  and child.Character:FindFirstChild("Humanoid") then -- and child.TeamColor ~= LocalPlayer.TeamColor for non-teamkill (add tk toggle)
            local HumanoidRootPart = child.Character:FindFirstChild("HumanoidRootPart")
            
            if (LocalPlayer.Character:FindFirstChild("HumanoidRootPart").Position - HumanoidRootPart.Position).Magnitude <= 45 then -- torso to max build = 90 studs
                local convertedhumanoidrootpartposition = convertposition(HumanoidRootPart.Position + child.Character:FindFirstChild("Humanoid").MoveDirection)
                local thresholdminimum = -2
                local thresholdmaximum = 2
                
                for loop_x = thresholdminimum, thresholdmaximum do
                    for loop_y = thresholdminimum + 1, thresholdmaximum - 1 do
                        for loop_z = thresholdminimum, thresholdmaximum do
                            if Vector3.new(loop_x, loop_y, loop_z) ~= convertedhumanoidrootpartposition then
                                coroutine.wrap(function()
                                    PlaceBlock(convertedhumanoidrootpartposition + Vector3.new(loop_x, loop_y, loop_z), "wool_" .. string.lower(tostring(LocalPlayer.Team.Name)))
                                end)()
                            end
                        end
                    end
                end
            end
        end
    end
end
local function scaffold() -- toggle
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character:FindFirstChild("Humanoid") then
        local convertedhumanoidrootpartposition = convertscaffoldposition(LocalPlayer.Character:FindFirstChild("HumanoidRootPart").Position + LocalPlayer.Character:FindFirstChild("Humanoid").MoveDirection)
		local thresholdminimum = -0
        local thresholdmaximum = 0
        
        for loop_x = thresholdminimum, thresholdmaximum do
            for loop_z = thresholdminimum, thresholdmaximum do
                coroutine.wrap(function()
                    PlaceBlock(convertedhumanoidrootpartposition + Vector3.new(loop_x, -2, loop_z), "wool_" .. string.lower(tostring(LocalPlayer.Team.Name)))
                end)()
            end
        end	
    end
end
local function coverbed()
    for childnumber, child in pairs(game.Workspace.Map.Blocks:GetChildren()) do
        if child.Name == "bed" and child.Covers.BrickColor == LocalPlayer.Team.TeamColor then
            local convertedbedposition = convertposition(child.Position)
            local thresholdminimum = -4
            local thresholdmaximum = 4
            
            for loop_x = thresholdminimum, thresholdmaximum do
                for loop_y = 0, thresholdmaximum + 1 do -- floor is a thing lol
                    for loop_z = thresholdminimum, thresholdmaximum do
                        coroutine.wrap(function()
                            PlaceBlock(convertedbedposition + Vector3.new(loop_x, loop_y, loop_z), "wool_" .. string.lower(tostring(LocalPlayer.Team.Name)))
                        end)()
                    end
                end
            end
        end
    end
end
local function currentlyequipped()
	local type = ""
	local obj = (isAlive() and lplr.Character:FindFirstChild("HandInvItem") and lplr.Character.HandInvItem.Value or nil)
	
	if obj then
		if obj.Name:find("sword") or obj.Name:find("blade") or obj.Name:find("baguette") then
			type = "sword"
		end
		if obj.Name:find("wool") then
			type = "block"
		end
		if obj.Name:find("bow") then
			type = "bow"
		end
	end
	
    return {["Object"] = obj, ["Type"] = type}
end

getgenv().window1_tab2_section1_hide_toggled = false
getgenv().window1_tab2_section1_scaffold_toggled = false
getgenv().window1_tab2_section1_scaffold_expansion = 0
getgenv().window1_tab2_section2_wool_toggled = false
-- IU
local IU = loadstring(game:HttpGet("https://raw.githubusercontent.com/araknala/work-released/main/Roblox/Exploits/Libraries/UI/IU.lua"))()

-- window1
local window1 = IU.CreateLib("bedwhores", "theme_warn")

--- window1_tab1
local window1_tab1 = window1:NewTab("info")
local window1_tab1_section1 = window1_tab1:NewSection('usage: click "functions"')
local window1_tab1_section2 = window1_tab1:NewSection("credits:")

window1_tab1_section2:NewButton("creator: araknala#0001", "araknala was here", function()
	setclipboard("araknala#0001")
end)
window1_tab1_section2:NewButton("server: nEyy6rfF", "join the discord server for patch info", function()
	requestfunction({
		Url = "http://127.0.0.1:6463/rpc?v=1",
		Method = "POST",
		Headers = {
			["Content-Type"] = "application/json",
			["Origin"] = "https://discord.com"
		},
		Body = game:GetService("HttpService"):JSONEncode({
			cmd = "INVITE_BROWSER",
			args = {
				code = "nEyy6rfF"
			},
			nonce = game:GetService("HttpService"):GenerateGUID(false)
		}),
	})
	setclipboard("https://www.discord.com/invite/nEyy6rfF")
end)

--- window1_tab2
local window1_tab2 = window1:NewTab("functions")
local window1_tab2_section1 = window1_tab2:NewSection("blocks")
local window1_tab2_section2 = window1_tab2:NewSection("autobuy")
local window1_tab2_section3 = window1_tab2:NewSection("bed")
local blockFolder = Instance.new("Folder")

blockFolder.Name = "blockFolder"
blockFolder.Parent = game.ReplicatedStorage

---- window1_tab2_section1
window1_tab2_section1:NewKeybind("buy", "quickly buy wool", Enum.KeyCode.B, function()
	buywool(1)
end)
window1_tab2_section1:NewKeybind("trap", "suffocates nearby players with wool", Enum.KeyCode.X, function()
    trapplayer()
end)
window1_tab2_section1:NewToggle("hide", "hide the blocks", function(state)
    if state == true then
        bindRenderStep("window1_tab2_section1_hide_toggled", 1, function()
            for blocknumber, block in pairs(game.Workspace.Map.Blocks:GetChildren()) do
        		if string.sub(block.Name, 1, 5) == "wool_" then
        			block.Parent = blockFolder
        		end
            end
	    end)
	elseif state == false then
	    unbindRenderStep("window1_tab2_section1_hide_toggled")
	    
		for blocknumber, block in pairs(blockFolder:GetChildren()) do
    		if string.sub(block.Name, 1, 5) == "wool_" then
    			block.Parent = game.Workspace.Map.Blocks
    		end
	    end
    end
end)
window1_tab2_section1:NewToggle("scaffold", "build blocks under you", function(state)
    if state == true then
        bindRenderStep("window1_tab2_section1_scaffold_toggled", 1, function()
            scaffold()
        end)
	elseif state == false then
		unbindRenderStep("window1_tab2_section1_scaffold_toggled")
    end
end)

---- window1_tab2_section2
window1_tab2_section2:NewToggle("wool", "autobuy wool", function(state)
    if state == true then
	    bindRenderStep("window1_tab2_section2_wool_toggled", 1, function()
    		buywool(1)
    	end)
	elseif state == false then
		unbindRenderStep("window1_tab2_section2_wool_toggled")
	end
end)

---- window1_tab2_section3
window1_tab2_section3:NewKeybind("cover", "covers your bed with wool", Enum.KeyCode.C, function()
    coverbed() -- add neg conv (binary), maybe scale, & loop/renderstep-bind cuz lag
end)

--- window1_tab3
local window1_tab3 = window1:NewTab("settings")
local window1_tab3_section1 = window1_tab3:NewSection("keybinds")

window1_tab3_section1:NewKeybind("toggle ui", "the keybind that toggles the visibility of the ui", Enum.KeyCode.F1, function()
	IU:ToggleUI()
end)